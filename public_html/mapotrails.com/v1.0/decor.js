!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(require("leaflet")):"function"==typeof define&&define.amd?define(["leaflet"],i):i(t.L)}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var i=function(t,i){return(180*Math.atan2(i.y-t.y,i.x-t.x)/Math.PI+90+360)%360},n=function(t,i){var n=t.value;return t.isInPixels?n/i:n};function o(t){if("string"==typeof t&&-1!==t.indexOf("%"))return{value:parseFloat(t)/100,isInPixels:!1};var i=t?parseFloat(t):0;return{value:i,isInPixels:i>0}}var e,r,s,a=function(t,i){return t.x===i.x&&t.y===i.y};function p(t){return t.reduce(function(t,n,o,e){if(o>0&&!a(n,e[o-1])){var r=e[o-1],s=t.length>0?t[t.length-1].distB:0,p=(h=r,l=(u=n).x-h.x,c=u.y-h.y,Math.sqrt(l*l+c*c));t.push({a:r,b:n,distA:s,distB:s+p,heading:i(r,n)})}var h,u,l,c;return t},[])}e=L.Marker.prototype._initIcon,r=L.Marker.prototype._setPos,s="msTransform"===L.DomUtil.TRANSFORM,L.Marker.addInitHook(function(){var t=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;t&&(t=t[0]+"px "+t[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||t||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(t){t.target._applyRotation()})}),L.Marker.include({_initIcon:function(){e.call(this)},_setPos:function(t){r.call(this,t),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,s?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(t){return this.options.rotationAngle=t,this.update(),this},setRotationOrigin:function(t){return this.options.rotationOrigin=t,this.update(),this}}),t.Symbol=t.Symbol||{},t.Symbol.Dash=t.Class.extend({options:{pixelSize:10,pathOptions:{}},initialize:function(i){t.Util.setOptions(this,i),this.options.pathOptions.clickable=!1},buildSymbol:function(i,n,o,e,r){var s=this.options,a=Math.PI/180;if(s.pixelSize<=1)return t.polyline([i.latLng,i.latLng],s.pathOptions);var p=o.project(i.latLng),h=-(i.heading-90)*a,u=t.point(p.x+s.pixelSize*Math.cos(h+Math.PI)/2,p.y+s.pixelSize*Math.sin(h)/2),l=p.add(p.subtract(u));return t.polyline([o.unproject(u),o.unproject(l)],s.pathOptions)}}),t.Symbol.dash=function(i){return new t.Symbol.Dash(i)},t.Symbol.ArrowHead=t.Class.extend({options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(i){t.Util.setOptions(this,i),this.options.pathOptions.clickable=!1},buildSymbol:function(i,n,o,e,r){return this.options.polygon?t.polygon(this._buildArrowPath(i,o),this.options.pathOptions):t.polyline(this._buildArrowPath(i,o),this.options.pathOptions)},_buildArrowPath:function(i,n){var o=Math.PI/180,e=n.project(i.latLng),r=-(i.heading-90)*o,s=this.options.headAngle/2*o,a=r+s,p=r-s,h=t.point(e.x-this.options.pixelSize*Math.cos(a),e.y+this.options.pixelSize*Math.sin(a)),u=t.point(e.x-this.options.pixelSize*Math.cos(p),e.y+this.options.pixelSize*Math.sin(p));return[n.unproject(h),i.latLng,n.unproject(u)]}}),t.Symbol.arrowHead=function(i){return new t.Symbol.ArrowHead(i)},t.Symbol.Marker=t.Class.extend({options:{markerOptions:{},rotate:!1},initialize:function(i){t.Util.setOptions(this,i),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1},buildSymbol:function(i,n,o,e,r){return this.options.rotate&&(this.options.markerOptions.rotationAngle=i.heading+(this.options.angleCorrection||0)),t.marker(i.latLng,this.options.markerOptions)}}),t.Symbol.marker=function(i){return new t.Symbol.Marker(i)};var h=function(i){return Array.isArray(i)&&((n=i[0])instanceof t.LatLng||Array.isArray(n)&&2===n.length&&"number"==typeof n[0]);var n};t.PolylineDecorator=t.FeatureGroup.extend({options:{patterns:[]},initialize:function(i,n){t.FeatureGroup.prototype.initialize.call(this),t.Util.setOptions(this,n),this._map=null,this._paths=this._initPaths(i),this._bounds=this._initBounds(),this._patterns=this._initPatterns(this.options.patterns)},_initPaths:function(i,n){var o=this;return h(i)?[n?i.concat([i[0]]):i]:i instanceof t.Polyline?this._initPaths(i.getLatLngs(),i instanceof t.Polygon):Array.isArray(i)?i.reduce(function(t,i){return t.concat(o._initPaths(i,n))},[]):[]},_initPatterns:function(t){return t.map(this._parsePatternDef)},setPatterns:function(t){this.options.patterns=t,this._patterns=this._initPatterns(this.options.patterns),this.redraw()},setPaths:function(t){this._paths=this._initPaths(t),this._bounds=this._initBounds(),this.redraw()},_parsePatternDef:function(t,i){return{symbolFactory:t.symbol,offset:o(t.offset),endOffset:o(t.endOffset),repeat:o(t.repeat)}},onAdd:function(t){this._map=t,this._draw(),this._map.on("moveend",this.redraw,this)},onRemove:function(i){this._map.off("moveend",this.redraw,this),this._map=null,t.FeatureGroup.prototype.onRemove.call(this,i)},_initBounds:function(){var i=this._paths.reduce(function(t,i){return t.concat(i)},[]);return t.latLngBounds(i)},getBounds:function(){return this._bounds},_buildSymbols:function(t,i,n){var o=this;return n.map(function(e,r){return i.buildSymbol(e,t,o._map,r,n.length)})},_getDirectionPoints:function(i,o){var e=this;return i.length<2?[]:function(t,i){var o=p(t),e=o.length;if(0===e)return[];var r=o[e-1].distB,s=n(i.offset,r),a=n(i.endOffset,r),h=r*n(i.repeat,r),u=a>0?r*a:0,l=[],c=s>0?r*s:0;do{l.push(c),c+=h}while(h>0&&c<r-u);var f=0,d=o[0];return l.map(function(t){for(;t>d.distB&&f<e-1;)d=o[++f];var i,n,r,s=(t-d.distA)/(d.distB-d.distA);return{pt:(i=d.a,n=d.b,r=s,n.x!==i.x?{x:i.x+r*(n.x-i.x),y:i.y+r*(n.y-i.y)}:{x:i.x,y:i.y+(n.y-i.y)*r}),heading:d.heading}})}(i.map(function(t){return e._map.project(t)}),o).map(function(i){return{latLng:e._map.unproject(t.point(i.pt)),heading:i.heading}})},redraw:function(){this._map&&(this.clearLayers(),this._draw())},_getPatternLayers:function(i){var n=this,o=this._map.getBounds().pad(.1);return this._paths.map(function(e){var r=n._getDirectionPoints(e,i).filter(function(t){return o.contains(t.latLng)});return t.featureGroup(n._buildSymbols(e,i.symbolFactory,r))})},_draw:function(){var i=this;this._patterns.map(function(t){return i._getPatternLayers(t)}).forEach(function(n){i.addLayer(t.featureGroup(n))})}}),t.polylineDecorator=function(i,n){return new t.PolylineDecorator(i,n)}});