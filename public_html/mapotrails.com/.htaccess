RewriteEngine On
RewriteBase /
Options -Indexes
Options +FollowSymlinks

DirectoryIndex index.php index.html

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.+)$ /$1.php [L,QSA]

ErrorDocument 500 /error.php?error=500
ErrorDocument 404 /error.php?error=404
ErrorDocument 403 /error.php?error=403
ErrorDocument 401 /error.php?error=401
RewriteRule ^error/([^/]*)$ /error.php?error_code=$1 [L,QSA]

# Redirect to WWW unless a subdomain
RewriteCond %{HTTPS} off [OR]
RewriteCond %{HTTP_HOST} !^www\. [NC]
RewriteCond %{HTTP_HOST} !^(cdn)\.mapotrails\.com$ [NC]
RewriteRule (.*) https://www.mapotrails.com%{REQUEST_URI} [R=301,L]

# APIs REWRITE
RewriteRule ^api/v([^/]*)/([^/]*)$ /apis/index.php?version=$1&api=$2 [L,QSA]
RewriteRule ^api/v([^/]*)/([^/]*)/([^/]*)$ /apis/index.php?version=$1&api=$2&method=$3 [L,QSA]
RewriteRule ^api/v([^/]*)/([^/]*)/([^/]*)/([^/]*)$ /apis/index.php?version=$1&api=$2&method=$3&function=$4 [L,QSA]
RewriteRule ^api/v([^/]*)/([^/]*)/([^/]*)/([^/]*)/([^/]*)$ /apis/index.php?version=$1&api=$2&method=$3&function=$4&extra=$5 [L,QSA]

# ASSETS REWRITE
RewriteRule ^src/([^/]*)/([^/]*)/([^/]*)$ /assets.php?type=$1&folder=$2&file=$3 [L,QSA]
RewriteRule ^src/([^/]*)/([^/]*)-([^/]*)$ /assets.php?type=$1&file=$2&version=$3 [L,QSA]
RewriteRule ^src/([^/]*)/([^/]*)$ /assets.php?type=$1&file=$2 [L,QSA]

# GUIDES
RewriteRule ^guide/([^/]*)/([^/]*)/([^/]*)$ /trailGuide.php?category=$1&tid=$2&url=$3 [L,QSA]
RewriteRule ^trail-system/([^/]*)/([^/]*)$ /trailSystem.php?sid=$1&url=$2 [L,QSA]

RewriteRule ^guides/([^/]*)/([^/]*)/([^/]*)$ /allguides.php?category=$1&activity=$2&area=$3 [L,QSA]
RewriteRule ^guides/([^/]*)/([^/]*)$ /allguides.php?category=$1&activity=$2 [L,QSA]
RewriteRule ^guides/([^/]*)$ /allguides.php?category=$1 [L,QSA]
RewriteRule ^guides$ /allguides.php [L,QSA]

# MAP URLS
RewriteRule ^trails/([^/]*)$ /index.php?tid=$1 [L,QSA]
RewriteRule ^snow$ /index.php?category=snow [L,QSA]
RewriteRule ^trail$ /index.php?category=trail [L,QSA]
RewriteRule ^snow/([^/]*)$ /index.php?category=snow&activity=$1 [L,QSA]
RewriteRule ^trail/([^/]*)$ /index.php?category=trail&activity=$1 [L,QSA]
RewriteRule ^snow/([^/]*)/([^/]*)$ /index.php?category=snow&activity=$1&area=$2 [L,QSA]
RewriteRule ^trail/([^/]*)/([^/]*)$ /index.php?category=trail&activity=$1&area=$2 [L,QSA]

# BMFPR
RewriteRule ^blue-mountains-forest-plan-revision$ /bmfpr/index.php [L,QSA]
RewriteRule ^blue-mountains-forest-plan-revision/about$ /bmfpr/about.php [L,QSA]

RewriteRule ^blue-mountains-forest-plan-revision/([^/]*)$ /bmfpr/index.php?type=$1 [L,QSA]

# SITEMAP
RewriteRule ^sitemap.xml$ /sitemap.xml.php [L,QSA]

# php -- BEGIN cPanel-generated handler, do not edit
# Set the “ea-php84” package as the default “PHP” programming language.
<IfModule mime_module>
  AddHandler application/x-httpd-ea-php84___lsphp .php .php8 .phtml
</IfModule>
# php -- END cPanel-generated handler, do not edit
